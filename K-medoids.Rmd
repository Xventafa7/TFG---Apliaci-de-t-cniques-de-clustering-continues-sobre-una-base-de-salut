---
title: "K-medoids"
author: "Xavier Ventayol Farras"
date: "18/6/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Llibreries:

```{r}
libraries <- function(){
 libr <- c("FactoMineR","car","plyr","cluster","factoextra","dplyr","mclust","ggplot2","ggExtra","NbClust","bestNormalize","gridExtra","ggpubr","ggtext","glue","corrplot","sqldf","tidyverse","ggpubr","rstatix","fastcluster","descr","plotly","kableExtra","pastecs")
 invisible(lapply(libr, library, character.only=TRUE))
}
libraries()
```


# Selecció de les mostres per homes i dones

## Llegim les dades

- Base de dades elsa complet sense missings 

```{r}
#load("elsa.rdata")
#dat <- as.data.frame(dat)
#class(dat)
#head(dat)
```

## Mostra dones

```{r}
#elsaD <- sqldf(
#  "select *
#   from dat
#   where sex = 'female'
#  ")

#sum(elsaD$sex == "female") #ha quedat comprovat que s'ha fet correctament

#set.seed(123)
#elsad <- elsaD[sample(nrow(elsaD), size = 200, replace = FALSE, prob = NULL),]
#save(elsad, file = "elsad.Rdata")
load("elsad.Rdata")
head(elsad)
```

## Mostra homes

```{r}
#elsaH <- sqldf(
#  "select *
#   from dat
#   where sex = 'male'
#  ")

#sum(elsaH$sex == "male") #ha quedat comprovat que s'ha fet correctament

#set.seed(123)
#elsah <- elsaH[sample(nrow(elsaH), size = 200, replace = FALSE, prob = NULL),]
#save(elsah, file = "elsah.Rdata")
load("elsah.Rdata")
head(elsah)
```



# Preparació de les mostres per aplicar el clustering

## Normalització i escalat de les dades

### Dones

Normalització de les dades

```{r}
#bmi_n <- bestNormalize(elsadN$bmi, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(bmi_n$x.t) #N

#hip_n <- bestNormalize(elsadN$hip, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(hip_n$x.t) #N

#grip_n <- bestNormalize(elsadN$grip, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(grip_n$x.t) #No normalitzat

#glucose_n <- bestNormalize(elsadN$glucose, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(glucose_n$x.t) #No noramlitzat

#triglycerides_n <- bestNormalize(elsadN$triglycerides, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(triglycerides_n$x.t) #No normalitzat per poc

#hdl_chol_n <- bestNormalize(elsadN$hdl_chol, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(hdl_chol_n$x.t) #no normalitzat

#total_chol_n <- bestNormalize(elsadN$total_chol, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(total_chol_n$x.t) #Normalitzat

#crp_n <- bestNormalize(elsadN$crp, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(crp_n$x.t) #Normalitzat

#healthstatus_n <- bestNormalize(elsadN$healthstatus, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(healthstatus_n$x.t) #No normalitzat per poc
```

Agafem les variables normalitzades i les escalem per aplicar els clústers

```{r}
#elsad_cl <- elsadN[,-14]
#names(elsad_cl)
#elsad_cl$bmi <- bmi_n$x.t
#elsad_cl$hip <- hip_n$x.t
#elsad_cl$grip <- grip_n$x.t
#elsad_cl$glucose <- glucose_n$x.t
#elsad_cl$triglycerides <- triglycerides_n$x.t
#elsad_cl$hdl_chol <- hdl_chol_n$x.t
#elsad_cl$total_chol <- total_chol_n$x.t
#elsad_cl$crp <- crp_n$x.t
#elsad_cl$healthstatus <- healthstatus_n$x.t
```

Una vegada totes les variables normalitzades el màxim possible, escalem la base de dades per poder fer els mètodes de clustering.

Ja s'ha creat la base de dades de variables continues i normalitzades elsad_cls

```{r}
#Escalem/estandaritzem les dades per poder crear els clústers
#elsad_cls <- as.data.frame(scale(elsad_cl))
load("scaledat_d.rdata")
head(elsad_cls)
#Es guarda la base de dades escalada i normalitzada
#save(elsad_cls, file = "scaledat_d.rdata")
```

### Homes

Normalització de les dades

```{r}
#bmi_n <- bestNormalize(elsahN$bmi, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(bmi_n$x.t) #No normalitzat per poc

#dbp_n <- bestNormalize(elsahN$dbp, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(dbp_n$x.t) #No normalitzat per poc

#glucose_n <- bestNormalize(elsahN$glucose, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(glucose_n$x.t) #No noramlitzat per poc

#triglycerides_n <- bestNormalize(elsahN$triglycerides, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(triglycerides_n$x.t) #Normalitzat

#hdl_chol_n <- bestNormalize(elsahN$hdl_chol, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(hdl_chol_n$x.t) #no normalitzat per poc

#crp_n <- bestNormalize(elsahN$crp, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(crp_n$x.t) #No normalitzat per poc

#healthstatus_n <- bestNormalize(elsahN$healthstatus, allow_orderNorm = FALSE, out_of_sample = FALSE)
#shapiro.test(healthstatus_n$x.t) #No normalitzat per poc
```

Agafem les variables normalitzades i les escalem per aplicar els clústers

```{r}
#elsah_cl <- elsahN[,-14]
#names(elsah_cl)
#elsah_cl$bmi <- bmi_n$x.t
#elsah_cl$dbp <- hip_n$x.t
#elsah_cl$glucose <- glucose_n$x.t
#elsah_cl$triglycerides <- triglycerides_n$x.t
#elsah_cl$hdl_chol <- hdl_chol_n$x.t
#elsah_cl$crp <- crp_n$x.t
#elsah_cl$healthstatus <- healthstatus_n$x.t
```

Una vegada totes les variables normalitzades el màxim possible, escalem la base de dades per poder fer els mètodes de clustering.

Ja s'ha creat la base de dades de variables continues i normalitzades elsah_cls

```{r}
#Escalem/estandaritzem les dades per poder crear els clústers
#elsah_cls <- as.data.frame(scale(elsah_cl))
load("scaledat_h.rdata")
head(elsah_cls)
#Es guarda la base de dades escalada i normalitzada
#save(elsah_cls, file = "scaledat_h.rdata")
```

## Comprovació de l'existència de clústers

### Dones

LA BBDD SÍ QUE ÉS CLUSTERITZABLES

```{r}
Hopkins_d <- get_clust_tendency(elsad_cls, n = nrow(elsad_cls)-1, graph = TRUE)
Hopkins_d$hopkins_stat 
```

### Homes

LA BBDD SÍ QUE ÉS CLUSTERITZABLES

```{r}
Hopkins_h <- get_clust_tendency(elsah_cls, n = nrow(elsah_cls)-1, graph = TRUE)
Hopkins_h$hopkins_stat 
```


# K-medoids

### Dones

Apliquem el mètode K-medoids per 3 clústers

```{r}
set.seed(123)
elsad.kmed3 <- pam(elsad_cls, 3, metric = "euclidean", stand = FALSE)
```

Visualització del mètode 3 clústers

```{r}
fviz_cluster(elsad.kmed3, data = elsad_cls, ellipse.type = "convex", palette = "jco", repel = FALSE, ggtheme = theme_minimal())
```

Sembla ser que hi ha diferència del K-means, amb tres clústers hi ha cert solapament entre grups

### Profiling Dones

```{r}
#variable indicadora dels clústers
var.ind.kmedd <- as.factor(elsad.kmed3$cluster)
#Base de dades amb la var indicadora dels clústers
elsad_kmed <- cbind(elsad, cluster = var.ind.kmedd)
head(elsad_kmed)
```

Solucionem el "label switching problem"

```{r}
#Cambien els labels dels clústers per entendre millor la comparativa de l'anàlisi
levels(elsad_kmed$cluster) <- c("1","3","2")
elsad_kmed$cluster <- as.factor(as.character(elsad_kmed$cluster))
levels(elsad_kmed$cluster) 
var.ind.kmedd <- elsad_kmed$cluster
```

Calculem la mida dels clústers, la mitjana i la mediana de les variables numèriques. 

```{r}
#Mida dels clústers
sum(elsad_kmed$cluster == 1); sum(elsad_kmed$cluster == 2); sum(elsad_kmed$cluster == 3)
#Mitjana i mediana
#Creem una base de dades auxiliar amb només les variables numèriques
elsad_kmed_n <- elsad_kmed[,c(10:23)]
aggregate(elsad_kmed_n, by = list(cluster = var.ind.kmedd), mean)
#aggregate(elsad_kmed_n, by = list(cluster = var.ind.kmedd), median)
```

Fem els test de kruskall wallys/Anova y chi-square per veure si hi ha diferències entre clústers

### Kruskal-wallis/anova i pearson's chi-square test

a) age

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(age)
#No hi ha outliers extrems 

#normalitat per clústers <- Tots els clústers són no normals
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(age)

#homoscedasticitat a través del Levene test
leveneTest(age ~ cluster, data = elsad_kmed) #hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsad_kmed %>% kruskal_test(age ~ cluster)
res.kruskal #hi ha diferències significatives entre grups

#pwc <- elsad_kmed %>% 
#  dunn_test(age ~ cluster, p.adjust.method = "bonferroni") 
#pwc 
```

b) bmi

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(bmi)
#Dos outliers extrems

#normalitat per clústers <- el tercer i el segon clúster no són normals
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(bmi)

#homoscedasticitat a través del Levene test
leveneTest(bmi ~ cluster, data = elsad_kmed) #No hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsad_kmed %>% kruskal_test(bmi ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsad_kmed %>% 
  dunn_test(bmi ~ cluster, p.adjust.method = "bonferroni") 
pwc 
```

c) waist

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(waist)
#1 outlier extrems 

#normalitat per clústers <- El 3r clúster no normal
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(waist)

#homoscedasticitat a través del Levene test
leveneTest(waist ~ cluster, data = elsad_kmed) #hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsad_kmed %>% kruskal_test(waist ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsad_kmed %>% 
  dunn_test(waist ~ cluster, p.adjust.method = "bonferroni") 
pwc 
```

d) hip

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(hip)
#Dels outliers del clúster 1 i 3 cap és extrem

#normalitat per clústers <- el tercer 2n i 3r no són normals
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(hip)

#homoscedasticitat a través del Levene test
leveneTest(hip ~ cluster, data = elsad_kmed) #No hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsad_kmed %>% kruskal_test(hip ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsad_kmed %>% 
  dunn_test(hip ~ cluster, p.adjust.method = "bonferroni") 
pwc 
```

e) grip

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(grip)
#outliers no extrems

#normalitat per clústers <- cap clúster normal
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(grip)

#homoscedasticitat a través del Levene test
leveneTest(grip ~ cluster, data = elsad_kmed) #hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsad_kmed %>% kruskal_test(grip ~ cluster)
res.kruskal #No hi ha diferències significatives entre grups

#pwc <- elsad_kmed %>% 
#  dunn_test(grip ~ cluster, p.adjust.method = "bonferroni") 
#pwc
```

f) sbp

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(sbp)
#Cap outlier és extrem

#normalitat per clústers <- El clúster 1 no és normal
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(sbp)

#homoscedasticitat a través del Levene test
leveneTest(sbp ~ cluster, data = elsad_kmed) #hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsad_kmed %>% kruskal_test(sbp ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsad_kmed %>% 
  dunn_test(sbp ~ cluster, p.adjust.method = "bonferroni") 
pwc
```

g) dbp

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(dbp)
#No hi ha outliers

#normalitat per clústers <- Tots són normals
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(dbp)

#homoscedasticitat a través del Levene test
leveneTest(dbp ~ cluster, data = elsad_kmed) #hi ha homoscedasticitat
```

- ANOVA

```{r}
ANOVA1 <- aov(dbp ~ cluster, elsad_kmed)
summary(ANOVA1) #hi ha diferències entre grups

#Anàlisis post-hoc
#Tukey test
TukeyHSD(ANOVA1, "cluster")
#t.test entre grups
pairwise.t.test(elsad_kmed$dbp, elsad_kmed$cluster, p.adj = "bonferroni") 
```

h) glucose

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(glucose)
#2 outliers extrems

#normalitat per clústers <- clústers no són normals
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(glucose)

#homoscedasticitat a través del Levene test
leveneTest(glucose ~ cluster, data = elsad_kmed) #hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsad_kmed %>% kruskal_test(glucose ~ cluster)
res.kruskal #hi ha diferències significatives entre grups

pwc <- elsad_kmed %>% 
  dunn_test(glucose ~ cluster, p.adjust.method = "bonferroni") 
pwc
```

i) triglycerides

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(triglycerides)
#1 outlier és extrem

#normalitat per clústers <- Cap clústers és normals
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(triglycerides)

#homoscedasticitat a través del Levene test
leveneTest(triglycerides ~ cluster, data = elsad_kmed) # hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsad_kmed %>% kruskal_test(triglycerides ~ cluster)
res.kruskal #hi ha diferències significatives entre grups

pwc <- elsad_kmed %>% 
  dunn_test(triglycerides ~ cluster, p.adjust.method = "bonferroni") 
pwc
```

j) hdl_chol

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(hdl_chol)
#Cap outlier és extrem

#normalitat per clústers <- el clúster 2 no és normal
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(hdl_chol)

#homoscedasticitat a través del Levene test
leveneTest(hdl_chol ~ cluster, data = elsad_kmed) # no hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsad_kmed %>% kruskal_test(hdl_chol ~ cluster)
res.kruskal #hi ha diferències significatives entre grups

pwc <- elsad_kmed %>% 
  dunn_test(hdl_chol ~ cluster, p.adjust.method = "bonferroni") 
pwc 
```

k) ldl_chol

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(ldl_chol)
#No hi ha outliers extrems

#normalitat per clústers <- Tots són normals
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(ldl_chol)

#homoscedasticitat a través del Levene test
leveneTest(ldl_chol ~ cluster, data = elsad_kmed) #hi ha homoscedasticitat
```

- ANOVA

```{r}
ANOVA1 <- aov(ldl_chol ~ cluster, elsad_kmed)
summary(ANOVA1) #hi ha diferències entre grups

#Anàlisis post-hoc
#Tukey test
TukeyHSD(ANOVA1, "cluster")
#t.test entre grups
pairwise.t.test(elsad_kmed$ldl_chol, elsad_kmed$cluster, p.adj = "bonferroni") 
```

l) total_chol

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(total_chol)
#outliers no extrems

#normalitat per clústers <- el 2n clúster no és normal
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(total_chol)

#homoscedasticitat a través del Levene test
leveneTest(total_chol ~ cluster, data = elsad_kmed) #hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsad_kmed %>% kruskal_test(total_chol ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsad_kmed %>% 
  dunn_test(total_chol ~ cluster, p.adjust.method = "bonferroni") 
pwc  
```

m) crp

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(crp)
#De 10 outliers tenim 5 que són extrems

#normalitat per clústers <- sembla a ser que els 3 grups són no normals
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(crp)
#Cal aplicar kruskal-wallis!

#homoscedasticitat a través del Levene test
leveneTest(crp ~ cluster, data = elsad_kmed) #no hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsad_kmed %>% kruskal_test(crp ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsad_kmed %>% 
  dunn_test(crp ~ cluster, p.adjust.method = "bonferroni") 
pwc 
```

n) healthstatus

```{r}
#mirem outliers
elsad_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(healthstatus)
#No hi ha outliers extrems

#normalitat per clústers <- Tots els clústers són normals
elsad_kmed %>%
  group_by(cluster) %>%
  shapiro_test(healthstatus)

#homoscedasticitat a través del Levene test
leveneTest(healthstatus ~ cluster, data = elsad_kmed) #hi ha homoscedasticitat
```

- ANOVA

```{r}
ANOVA1 <- aov(healthstatus ~ cluster, elsad_kmed)
summary(ANOVA1) #hi ha diferències entre grups

#Anàlisis post-hoc
#Tukey test
TukeyHSD(ANOVA1, "cluster")
#t.test entre grups
pairwise.t.test(elsad_kmed$healthstatus, elsad_kmed$cluster, p.adj = "bonferroni") 
```


#### Chi-square test of independence

Chi-square per veure si hi ha diferències entre clústers

a) marital_status
```{r}
ct <- table(elsad_kmed$marital_status,elsad_kmed$cluster)
ct
chisq.test(ct) #no hi ha associació entre clusters, variables independents
```

b) education

```{r}
ct <- table(elsad_kmed$education,elsad_kmed$cluster)
ct
chisq.test(ct) 

# diferències C1 i C2
df <- subset(elsad_kmed, cluster == 1 | cluster == 2)
df$cluster <- as.factor(as.character(df$cluster))
ct1 <- table(df$education,df$cluster)
ct1
chisq.test(ct1)

# diferències C1 i C3
df2 <- subset(elsad_kmed, cluster == 1 | cluster == 3)
df2$cluster <- as.factor(as.character(df2$cluster))
ct2 <- table(df2$education,df2$cluster)
ct2
chisq.test(ct2)

# diferències C2 i C3
df3 <- subset(elsad_kmed, cluster == 2 | cluster == 3)
df3$cluster <- as.factor(as.character(df3$cluster))
ct3 <- table(df3$education,df3$cluster)
ct3
chisq.test(ct3)
#c1 i c2 diferents
```

c) wealth

```{r}
ct <- table(elsad_kmed$wealth,elsad_kmed$cluster)
ct
chisq.test(ct) 

# diferències C1 i C2
df <- subset(elsad_kmed, cluster == 1 | cluster == 2)
df$cluster <- as.factor(as.character(df$cluster))
ct1 <- table(df$wealth,df$cluster)
ct1
chisq.test(ct1)

# diferències C1 i C3
df2 <- subset(elsad_kmed, cluster == 1 | cluster == 3)
df2$cluster <- as.factor(as.character(df2$cluster))
ct2 <- table(df2$wealth,df2$cluster)
ct2
chisq.test(ct2)

# diferències C2 i C3
df3 <- subset(elsad_kmed, cluster == 2 | cluster == 3)
df3$cluster <- as.factor(as.character(df3$cluster))
ct3 <- table(df3$wealth,df3$cluster)
ct3
chisq.test(ct3)
#c1 i c2 diferents
#c1 i c3 diferents
```

d) loneliness

```{r}
ct <- table(elsad_kmed$loneliness,elsad_kmed$cluster)
ct
chisq.test(ct) #no hi ha associació entre clusters, variables independents
```

e) level_pa

```{r}
ct <- table(elsad_kmed$level_pa,elsad_kmed$cluster)
ct
chisq.test(ct) #no hi ha associació entre clusters, variables independents

```

f) ah

```{r}
ct <- table(elsad_kmed$ah,elsad_kmed$cluster)
ct
chisq.test(ct) #hi ha associació entre clusters, variables dependents

# diferències C1 i C2
df <- subset(elsad_kmed, cluster == 1 | cluster == 2)
df$cluster <- as.factor(as.character(df$cluster))
ct1 <- table(df$ah,df$cluster)
ct1
chisq.test(ct1)

# diferències C1 i C3
df2 <- subset(elsad_kmed, cluster == 1 | cluster == 3)
df2$cluster <- as.factor(as.character(df2$cluster))
ct2 <- table(df2$ah,df2$cluster)
ct2
chisq.test(ct2)

# diferències C2 i C3
df3 <- subset(elsad_kmed, cluster == 2 | cluster == 3)
df3$cluster <- as.factor(as.character(df3$cluster))
ct3 <- table(df3$ah,df3$cluster)
ct3
chisq.test(ct3)
#c1 i c2 diferents
#c1 i c3 diferents
```


g) depression

```{r}
ct <- table(elsad_kmed$depression,elsad_kmed$cluster)
ct
chisq.test(ct) #no hi ha associació entre clusters, variables independents
```


h) srh

```{r}
ct <- table(elsad_kmed$srh,elsad_kmed$cluster)
ct
chisq.test(ct) #no hi ha associació entre clusters, variables independents

```

#### Boxplots i barcharts

Boxplots i bar charts de totes les variables de la mostra, estratificat per clústers, que han resultat significatives.

- Figura 9.19

```{r}
x1 <- ggplot(elsad_kmed, aes(group = cluster, x = cluster, y = bmi)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Índex de massa corporal")
x2 <- ggplot(elsad_kmed, aes(group = cluster, x = cluster, y = triglycerides)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Triglicèrids")
x3 <- ggplot(elsad_kmed, aes(group = cluster, x = cluster, y = glucose)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Glucosa")
x4 <- ggplot(elsad_kmed, aes(group = cluster, x = cluster, y = waist)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Circumferència cintura")

grid.arrange(x1, x2, x3, x4, nrow = 2, ncol = 2)
```

- Figura 9.20

```{r}
x1 <- ggplot(elsad_kmed, aes(group = cluster, x = cluster, y = sbp)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Pressió sistòlica")
x2 <- ggplot(elsad_kmed, aes(group = cluster, x = cluster, y = dbp)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Pressió diastòlica")
x3 <- ggplot(elsad_kmed, aes(group = cluster, x = cluster, y = crp)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Proteïna PCR")

grid.arrange(x1, x2, x3, nrow = 2, ncol = 2)
```

- Figura 9.21

```{r}
x1 <- ggplot(elsad_kmed, aes(group = cluster, x = cluster, y = ldl_chol)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Colesterol LDL")
x2 <- ggplot(elsad_kmed, aes(group = cluster, x = cluster, y = hdl_chol)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Colesterol HDL")
x3 <- ggplot(elsad_kmed, aes(group = cluster, x = cluster, y = total_chol)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Colesterol total")
x4 <- ggplot(elsad_kmed, aes(group = cluster, x = cluster, y = healthstatus)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Healthstatus")

grid.arrange(x1, x2, x3, x4, nrow = 2, ncol = 2)
```

- Figura 9.22

```{r}
x1 <- ggplot(data = elsad_kmed, aes(x = cluster)) +
    geom_bar(aes(fill = education), position = "dodge") +
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Educació")
x2 <- ggplot(data = elsad_kmed, aes(x = cluster)) +
    geom_bar(aes(fill = ah), position = "dodge") +
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Hipertensió arterial")
x3 <- ggplot(data = elsad_kmed, aes(x = cluster)) +
    geom_bar(aes(fill = wealth), position = "dodge") +
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Riquesa de la llar")

grid.arrange(x1, x2, x3, nrow = 2, ncol = 2)
```


### Homes

Apliquem el mètode K-medoids per 3 clústers

```{r}
set.seed(123)
elsah.kmed3 <- pam(elsah_cls, 3, metric = "euclidean", stand = FALSE)
```

Visualització del mètode 3 clústers

```{r}
#Abans de resoldre el label switching problem
fviz_cluster(elsah.kmed3, data = elsah_cls, ellipse.type = "convex", palette = "jco", repel = FALSE, ggtheme = theme_minimal())
```

Pels homes, amb 3 clústers sembla a ser que hi ha molt solapament entre els grups, més que amb les dones

### Profiling Homes

```{r}
#variable indicadora dels clústers
var.ind.kmedh <- as.factor(elsah.kmed3$cluster)
#Base de dades amb la var indicadora dels clústers
elsah_kmed <- cbind(elsah, cluster = var.ind.kmedh)
head(elsah_kmed)
```

Solucionem el "label switching problem"

```{r}
#Cambien els labels dels clústers per entendre millor la comparativa de l'anàlisi
levels(elsah_kmed$cluster) <- c("2","1","3")
elsah_kmed$cluster <- as.factor(as.character(elsah_kmed$cluster))
levels(elsah_kmed$cluster) 
var.ind.kmedh <- elsah_kmed$cluster
```

Calculem la mida dels clústers, la mitjana i la mediana de les variables numèriques. 

```{r}
#Mida dels clústers
sum(elsah_kmed$cluster == 1); sum(elsah_kmed$cluster == 2); sum(elsah_kmed$cluster == 3)
#Mitjana i mediana
#Creem una base de dades auxiliar amb només les variables numèriques
elsah_kmed_n <- elsah_kmed[,c(10:23)]
aggregate(elsah_kmed_n, by = list(cluster = var.ind.kmedh), mean)
aggregate(elsah_kmed_n, by = list(cluster = var.ind.kmedh), median)
```

Fem els test de kruskall wallys/ANOVA y chi-square per veure si hi ha diferències entre clústers

#### Kruskal-wallis/ANOVA

a) age

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(age)
#No hi ha outliers extrems 

#normalitat per clústers <- Tots els clústers són no normals
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(age)

#homoscedasticitat a través del Levene test
leveneTest(age ~ cluster, data = elsah_kmed) #hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsah_kmed %>% kruskal_test(age ~ cluster)
res.kruskal #hi ha diferències significatives entre grups

pwc <- elsah_kmed %>% 
  dunn_test(age ~ cluster, p.adjust.method = "bonferroni") 
pwc 
```

b) bmi

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(bmi)
#Dels outliers del clúster 1 i 3 cap és extrem

#normalitat per clústers <- el primer clúster no és normal
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(bmi)

#homoscedasticitat a través del Levene test
leveneTest(bmi ~ cluster, data = elsah_kmed) #No hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsah_kmed %>% kruskal_test(bmi ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsah_kmed %>% 
  dunn_test(bmi ~ cluster, p.adjust.method = "bonferroni") 
pwc 
```

c) waist

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(waist)
#No hi ha outliers extrems 

#normalitat per clústers <- c1 no normal
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(waist)

#homoscedasticitat a través del Levene test
leveneTest(waist ~ cluster, data = elsah_kmed) #hi ha homoscedasticitat
```

- s'ha de fer kruskal-wallis

```{r}
res.kruskal <- elsah_kmed %>% kruskal_test(waist ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsah_kmed %>% 
  dunn_test(waist ~ cluster, p.adjust.method = "bonferroni") 
pwc
```

d) hip

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(hip)
#Dels outliers del clúster 1 i 3 cap és extrem

#normalitat per clústers <- el tercer clúster no és normal
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(hip)

#homoscedasticitat a través del Levene test
leveneTest(hip ~ cluster, elsah_kmed) #No homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsah_kmed %>% kruskal_test(hip ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsah_kmed %>% 
  dunn_test(hip ~ cluster, p.adjust.method = "bonferroni") 
pwc
```

e) grip

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(grip)
#1 outlier extrem

#normalitat per clústers <- clústers normals
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(grip)

#homoscedasticitat a través del Levene test
leveneTest(grip ~ cluster, data = elsah_kmed) #homoscedasticitat
#aplicar kruskal-wallis <- 1 outlier extrem
```

- kruskal-wallis

```{r}
res.kruskal <- elsah_kmed %>% kruskal_test(grip ~ cluster)
res.kruskal #Hi ha diferències significatives entre grups

pwc <- elsah_kmed %>% 
  dunn_test(grip ~ cluster, p.adjust.method = "bonferroni") 
pwc
```

f) sbp

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(sbp)
#Cap outlier és extrem

#normalitat per clústers <- clústers no normals
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(sbp)

#homoscedasticitat a través del Levene test
leveneTest(sbp ~ cluster, data = elsah_kmed) #hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsah_kmed %>% kruskal_test(sbp ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsah_kmed %>% 
  dunn_test(sbp ~ cluster, p.adjust.method = "bonferroni") 
pwc  
```

g) dbp

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(dbp)
#No hi ha outliers

#normalitat per clústers <- Tots són normals
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(dbp)

#homoscedasticitat a través del Levene test
leveneTest(dbp ~ cluster, data = elsah_kmed) #hi ha homoscedasticitat
```

- ANOVA

```{r}
ANOVA1 <- aov(dbp ~ cluster, elsah_kmed)
summary(ANOVA1) #no hi ha diferències entre grups

#Anàlisis post-hoc
#Tukey test
#TukeyHSD(ANOVA1, "cluster")
#t.test entre grups
#pairwise.t.test(elsah_kmed$dbp, elsah_kmed$cluster, p.adj = "bonferroni") 
```

h) glucose

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(glucose)
#Menys 1 tots els outliers són no extrems

#normalitat per clústers <- Cap clúster és normals
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(glucose)

#homoscedasticitat a través del Levene test
leveneTest(glucose ~ cluster, data = elsah_kmed) #hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsah_kmed %>% kruskal_test(glucose ~ cluster)
res.kruskal #hi ha diferències significatives entre grups

pwc <- elsah_kmed %>% 
  dunn_test(glucose ~ cluster, p.adjust.method = "bonferroni") 
pwc 
```

i) triglycerides

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(triglycerides)
#Cap outlier és extrem

#normalitat per clústers <- Cap clúster és normals
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(triglycerides)

#homoscedasticitat a través del Levene test
leveneTest(triglycerides ~ cluster, data = elsah_kmed) # hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsah_kmed %>% kruskal_test(triglycerides ~ cluster)
res.kruskal #hi ha diferències significatives entre grups

pwc <- elsah_kmed %>% 
  dunn_test(triglycerides ~ cluster, p.adjust.method = "bonferroni") 
pwc
```

j) hdl_chol

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(hdl_chol)
#Cap outlier és extrem

#normalitat per clústers <- cap clúster normal
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(hdl_chol)

#homoscedasticitat a través del Levene test
leveneTest(hdl_chol ~ cluster, data = elsah_kmed) #hi ha homocesdasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsah_kmed %>% kruskal_test(hdl_chol ~ cluster)
res.kruskal #hi ha diferències significatives entre grups

pwc <- elsah_kmed %>% 
  dunn_test(hdl_chol ~ cluster, p.adjust.method = "bonferroni") 
pwc
```

k) ldl_chol

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(ldl_chol)
#No hi ha outliers extrems

#normalitat per clústers <- Tots són normals
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(ldl_chol)

#homoscedasticitat a través del Levene test
leveneTest(ldl_chol ~ cluster, data = elsah_kmed) #sí 
```

- ANOVA

```{r}
ANOVA1 <- aov(ldl_chol ~ cluster, elsah_kmed)
summary(ANOVA1) #hi ha diferències entre grups

#Anàlisis post-hoc
#Tukey test
TukeyHSD(ANOVA1, "cluster")
#t.test entre grups
pairwise.t.test(elsah_kmed$ldl_chol, elsah_kmed$cluster, p.adj = "bonferroni") 
```

l) total_chol

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(total_chol)
#Outliers no extrems

#normalitat per clústers <- tots normals
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(total_chol)

#homoscedasticitat a través del Levene test
leveneTest(total_chol ~ cluster, data = elsah_kmed) #sí
```

- ANOVA

```{r}
ANOVA1 <- aov(total_chol ~ cluster, elsah_kmed)
summary(ANOVA1) #hi ha diferències entre grups

#Anàlisis post-hoc
#Tukey test
TukeyHSD(ANOVA1, "cluster")
#t.test entre grups
pairwise.t.test(elsah_kmed$total_chol, elsah_kmed$cluster, p.adj = "bonferroni") 
```

m) crp

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(crp)
#De 10 outliers tenim 6 que són extrems

#normalitat per clústers <- sembla a ser que els 3 grups són no normals
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(crp)

#homoscedasticitat a través del Levene test
leveneTest(crp ~ cluster, data = elsah_kmed) #no
```

- kruskal-wallis

```{r}
res.kruskal <- elsah_kmed %>% kruskal_test(crp ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsah_kmed %>% 
  dunn_test(crp ~ cluster, p.adjust.method = "bonferroni") 
pwc 
```

n) healthstatus

```{r}
#mirem outliers
elsah_kmed %>% 
  group_by(cluster) %>% 
  identify_outliers(healthstatus)
#No hi ha outliers extrems

#normalitat per clústers <- 2 clústers no normals
elsah_kmed %>%
  group_by(cluster) %>%
  shapiro_test(healthstatus)

#homoscedasticitat a través del Levene test
leveneTest(healthstatus ~ cluster, data = elsah_kmed) #hi ha homoscedasticitat
```

- kruskal-wallis

```{r}
res.kruskal <- elsah_kmed %>% kruskal_test(healthstatus ~ cluster)
res.kruskal #Hi ha diferències entre grups

pwc <- elsah_kmed %>% 
  dunn_test(healthstatus ~ cluster, p.adjust.method = "bonferroni") 
pwc  
```

#### Chi-square test of independence

Chi-square per veure si hi ha diferències entre clústers

a) marital_status
```{r}
ct <- table(elsah_kmed$marital_status,elsah_kmed$cluster)
ct
chisq.test(ct) #no hi ha associació entre clusters, variables independents
```

b) education

```{r}
ct <- table(elsah_kmed$education,elsah_kmed$cluster)
ct
chisq.test(ct) 

# diferències C1 i C2 <- si són diferents
df <- subset(elsah_kmed, cluster == 1 | cluster == 2)
df$cluster <- as.factor(as.character(df$cluster))
ct1 <- table(df$education,df$cluster)
ct1
chisq.test(ct1)

# diferències C1 i C3
df2 <- subset(elsah_kmed, cluster == 1 | cluster == 3)
df2$cluster <- as.factor(as.character(df2$cluster))
ct2 <- table(df2$education,df2$cluster)
ct2
chisq.test(ct2)

# diferències C2 i C3
df3 <- subset(elsah_kmed, cluster == 2 | cluster == 3)
df3$cluster <- as.factor(as.character(df3$cluster))
ct3 <- table(df3$education,df3$cluster)
ct3
chisq.test(ct3)
```

c) wealth

```{r}
ct <- table(elsah_kmed$wealth,elsah_kmed$cluster)
ct
chisq.test(ct) #no hi ha associació entre clusters, variables independents

```

d) loneliness

```{r}
ct <- table(elsah_kmed$loneliness,elsah_kmed$cluster)
ct
chisq.test(ct) #no hi ha associació entre clusters, variables independents
```

e) level_pa

```{r}
ct <- table(elsah_kmed$level_pa,elsah_kmed$cluster)
ct
chisq.test(ct) #no hi ha associació entre clusters, variables independents

```

f) ah

```{r}
ct <- table(elsah_kmed$ah,elsah_kmed$cluster)
ct
chisq.test(ct) #hi ha associació entre clusters, variables dependents

# diferències C1 i C2 <- diferents
df <- subset(elsah_kmed, cluster == 1 | cluster == 2)
df$cluster <- as.factor(as.character(df$cluster))
ct1 <- table(df$ah,df$cluster)
ct1
chisq.test(ct1)

# diferències C1 i C3 <- diferents
df2 <- subset(elsah_kmed, cluster == 1 | cluster == 3)
df2$cluster <- as.factor(as.character(df2$cluster))
ct2 <- table(df2$ah,df2$cluster)
ct2
chisq.test(ct2)

# diferències C2 i C3
df3 <- subset(elsah_kmed, cluster == 2 | cluster == 3)
df3$cluster <- as.factor(as.character(df3$cluster))
ct3 <- table(df3$ah,df3$cluster)
ct3
chisq.test(ct3)
```


g) depression

```{r}
ct <- table(elsah_kmed$depression,elsah_kmed$cluster)
ct
chisq.test(ct) #no hi ha associació entre clusters, variables independents
```


h) srh

```{r}
ct <- table(elsah_kmed$srh,elsah_kmed$cluster)
ct
chisq.test(ct) #no hi ha associació entre clusters, variables independents

# diferències C1 i C2 <- diferents
df <- subset(elsah_kmed, cluster == 1 | cluster == 2)
df$cluster <- as.factor(as.character(df$cluster))
ct1 <- table(df$srh,df$cluster)
ct1
chisq.test(ct1)

# diferències C1 i C3 <- casi diferents
df2 <- subset(elsah_kmed, cluster == 1 | cluster == 3)
df2$cluster <- as.factor(as.character(df2$cluster))
ct2 <- table(df2$srh,df2$cluster)
ct2
chisq.test(ct2)

# diferències C2 i C3
df3 <- subset(elsah_kmed, cluster == 2 | cluster == 3)
df3$cluster <- as.factor(as.character(df3$cluster))
ct3 <- table(df3$srh,df3$cluster)
ct3
chisq.test(ct3)
```

#### Boxplots i barcharts

Boxplots i bar charts de totes les variables de la mostra, estratificat per clústers, que han resultat significatives.

- Figura 9.23

```{r}
x1 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = bmi)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Índex de massa corporal")
x2 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = ldl_chol)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Colesterol LDL")
x3 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = total_chol)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Colesterol total")
x4 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = waist)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Circumferència cintura")

grid.arrange(x1, x2, x3, x4, nrow = 2, ncol = 2)
```

- Figura 9.24

```{r}
x1 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = sbp)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Pressió sistòlica")
x2 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = glucose)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Glucosa")
x3 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = crp)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Proteïna PCR")
x4 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = healthstatus)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Healthstatus")

grid.arrange(x1, x2, x3, x4, nrow = 2, ncol = 2)
```

- Figura 9.25

```{r}
x1 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = grip)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Força d'adherència")
x2 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = hdl_chol)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Colesterol HDL")


grid.arrange(x1, x2, nrow = 2, ncol = 2)
```

- Figura 9.26

```{r}
x1 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = age)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Edat")
x2 <- ggplot(elsah_kmed, aes(group = cluster, x = cluster, y = triglycerides)) + 
    geom_boxplot(fill = c("lightblue", "yellow", "grey"), color= "black", outlier.colour = "red", outlier.shape = 1) +
    stat_summary(fun.y=mean, geom = "point", shape = 15, size = 2)+
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Triglicèrids")


grid.arrange(x1, x2, nrow = 2, ncol = 2)
```

- Figura 9.27

```{r}
x1 <- ggplot(data = elsah_kmed, aes(x = cluster)) +
    geom_bar(aes(fill = education), position = "dodge") +
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Educació")
x2 <- ggplot(data = elsah_kmed, aes(x = cluster)) +
    geom_bar(aes(fill = ah), position = "dodge") +
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Hipertensió arterial")
x3 <- ggplot(data = elsah_kmed, aes(x = cluster)) +
    geom_bar(aes(fill = srh), position = "dodge") +
    theme(plot.title = element_text(hjust = 0.5))+
    ggtitle("Autoavaluació de salut")

grid.arrange(x1, x2, x3, nrow = 2, ncol = 2)
```

